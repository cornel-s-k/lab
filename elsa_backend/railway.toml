[build]
builder = "nixpacks"

[start]
command = """
echo '=== RAILWAY.TOML JALAN! ===' && \
echo '=== CEK LOGO_URL SEBELUM ===' && \
php artisan tinker --execute=\"echo \\App\\Models\\Partner::first()->logo_url ?? 'NULL';\" && \
echo 'UPDATE LOGO_URL KE NAMA FILE SAJA...' && \
php artisan tinker --execute=\"\\App\\Models\\Partner::all()->each(function (\\$p) { \\$url = \\$p->logo_url; if (\\$url && str_contains(\\$url, '/')) { \\$p->logo_url = basename(\\$url); \\$p->save(); } });\" && \
echo '=== CEK LOGO_URL SESUDAH ===' && \
php artisan tinker --execute=\"echo \\App\\Models\\Partner::first()->logo_url ?? 'NULL';\" && \
echo 'PINDAHKAN FILE KE PUBLIC...' && \
mkdir -p public/partners && \
cp -r storage/app/public/* public/partners/ 2>/dev/null || true && \
echo '=== ISI public/partners ===' && \
ls -la public/partners/ | head -5 && \
php artisan config:cache && \
php artisan route:cache && \
php artisan view:cache && \
echo '=== DEPLOY SELESAI! ===' && \
php artisan serve --host 0.0.0.0 --port ${PORT}
"""

[deploy]
startCommand = "php artisan serve --host=0.0.0.0 --port=${PORT}"